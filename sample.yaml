---
encoding: 'utf-8'
enabled: true
endpoint: people
info: This endpoint is for saving and restoring people.

CREATE:
  - op: create
    query:
      databank: MySQL
      op: INSERT INTO people (name, age, hobbies) VALUES (%s, %s, %s)
      params:
      - "{{ url.name }}"
      - "{{ url.age }}"
      - "{{ url.hobbies  }}"
READ:
  mandate:
    json:
      test: true
    uri:
      member:
        type: "string"
        contains:
        - "list"
        - "of"
        - "patterns"
        search:
     url:
       page:
         type: "number"
         allow:
         - this > 0
       
  query:
    bank: MySQL
    op: SELECT * FROM people
    params:
    - "{{ uri.member }}"

  transform:
  - op: mutate
    formal: "Sir {{ this.name }}"
    lucky:
      data: "{{ this.age - 13 }}"
      type: integer
    expires:
      key: created
      type: datetime
      +delta:
        weeks: 2
    timestamp:
      key: created
      type: string

  - op: pop
    keys:
    - list
    - of
    - keys

  - op: accept
    when:
    - this.lucky != 13
    - this.expires >= now

  - op: re.search
    action: reject
    keys:
    - name
    patterns:
    - '^Myke'

  - op: group
    keys:
    - name
    mutate:
      name: "{{ group.max('created', name) }}"
      man years:
        data: "{{ group.sum('age') }}"
        type: integer
      average:
        data: "{{ group.avg('age') }}"
        type: number

  - op: limit
    limit: "{{ url.limit }}"

  - op: pagify
    amount: 10
    pages: "{{ url.page }}"

UPDATE:
  - op: update

DELETE:
  - op: delete
